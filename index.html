<!DOCTYPE html>
<html> 
    <head>
     <title>Google Homepage</title>
     <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            overflow-x: hidden;
        }
        img {
            display: block;
            margin: auto;
            padding-top: 60px;
            padding-bottom: 20px;
        }
        a {
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        ul {
            padding-left: 0px;
            list-style: none;
        }
        li {
            display: inline-block;
            padding: 7px 5px;
            opacity: 0.65; 
        }
        .b {
            color: black;
        }
        .gmail {
            padding-right: 10px;
            float: right;
        }
        #sign {
            float: right;
            opacity: 1;
            background: #4887ef; 
            margin-right: 25px;
            padding: 7px 15px;
            border-radius: 3px; 
            font-weight: bold; 
        }
        #sign:hover { 
            box-shadow: 1px 1px 5px #999;
        }
        .form {
            text-align: center;
        }  
        #search {
            opacity: .35;
            border-width: 1px;
            border-radius: 30px;
            width: 450px;
            padding: 15px 15px;
            border-style: solid;
            border-color: #dfe1e5;
            outline: none;
        }
        .button {
            text-align: center;
            padding: 20px;
        }
        #button {
            padding: 10px 16px;
            border: 1px solid transparent;
            border-radius: 6px;
            background-color: #f8f9fa;
            color: #3c4043;
            cursor: pointer;
        }
        #button:hover {
            border: 1px solid #dadce0;
            box-shadow: 0 1px 1px rgba(0,0,0,.1);
        }
        footer {
            background: #f2f2f2;
            border-top: 2px solid #e4e4e4; 
            bottom: 0;
            left: 0;
            right: 0;
            position: absolute;
        }
        footer ul {
            display: inline-block;
            padding: 0 20px;
        }
        .menu {
            float: right;
            padding-top: 0; 
            padding-left: 0;
            display: inline-block;
            height: 30px;
            width: 30px;
            background-image: url(https://ssl.gstatic.com/gb/images/i1_1967ca6a.png);
            background-position: -132px -38px;
        }

        /* Stealth Overlay Styles */
        #stealthOverlay {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: none; flex-direction: column; align-items: center; padding: 3rem;
            color: #fff;
        }
        .stealth-title { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 3px; color: #444; margin-bottom: 2rem; }
        .game-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
            gap: 10px; width: 100%; max-width: 900px; overflow-y: auto; 
        }
        .game-name {
            padding: 0.75rem; color: #999; cursor: pointer; border: 1px solid #222; 
            border-radius: 4px; text-align: center; font-size: 0.9rem; transition: all 0.2s;
            font-family: 'Inter', sans-serif;
        }
        .game-name:hover { color: #fff; border-color: #555; background: #111; }
     </style>
    </head>

    <body>
        <header>
         <nav>
          <ul>
             <li><a class="b" href="">About</a></li>
             <li><a class="b" href="">Store</a></li>
             <li id="sign"><a style="color: white;" href="">Sign In</a></li>
             <li class="menu"><a href=""></a> </li>
             <li class="gmail" ><a class="b" href="">Images</a></li>
             <li class="gmail"><a class="b" href="">Gmail</a></li>
          </ul>   
         </nav>
        </header>

        <div>
            <img src="https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png" alt="Google Logo">
        </div>

        <div>
            <form class="form" onsubmit="return false;">
                <label for="search"></label>
                <input type="text" id="search" placeholder="Search Google or type URL">
            </form>
        </div>

        <div class="button">
            <input id="button" type="submit" value="Google Search">
            <input id="button" type="submit" value="I'm Feeling Lucky">
        </div>
        
        <footer>
            <ul>
                <li><a class="b" href="">Advertising</a></li>
                <li><a class="b" href="">Business</a></li>
                <li><a class="b" href="">How Search Works</a></li>
            </ul>
            <ul style="float: right;">
                <li><a class="b" href="">Privacy</a></li>
                <li><a class="b" href="">Terms</a></li>
                <li><a class="b" href="">Settings</a></li>
            </ul>
        </footer>

        <!-- Hidden Stealth Menu -->
        <div id="stealthOverlay">
            <div class="stealth-title">Project Override / Esc to close</div>
            <div class="game-grid" id="gameGrid"></div>
        </div>

        <script>
            let gameData = [];
            let typedSecret = "";
            const secretPhrase = "schooltools123";
            const overlay = document.getElementById('stealthOverlay');

            // 1. Fetch zones.json logic
            async function loadDirectory() {
                try {
                    const res = await fetch('/zones.json');
                    gameData = await res.json();
                } catch (e) {
                    console.warn("Catalog fetch failed.");
                }
            }

            // 2. Secret Phrase Listener (Type 'schooltools123')
            window.addEventListener('keydown', (e) => {
                // If Esc is pressed, hide overlay 
                if (e.key === 'Escape') {
                    overlay.style.display = 'none';
                    typedSecret = "";
                    return;
                }

                // Append key to secret buffer
                if (e.key.length === 1) {
                    typedSecret += e.key;
                    if (typedSecret.includes(secretPhrase)) {
                        overlay.style.display = 'flex';
                        renderNames();
                        typedSecret = ""; // Reset after trigger
                    }
                    // Keep buffer small (only check for last X chars)
                    if (typedSecret.length > 50) typedSecret = typedSecret.slice(-14);
                }
            });

            // 3. Render Game List
            function renderNames() {
                const grid = document.getElementById('gameGrid');
                grid.innerHTML = '';
                gameData.forEach(game => {
                    const div = document.createElement('div');
                    div.className = 'game-name';
                    div.textContent = game.name;
                    div.onclick = () => launch(game.url);
                    grid.appendChild(div);
                });
            }

            // 4. Launcher Logic with Loader
            async function launch(url) {
                const finalUrl = url.replace('{HTML_URL}', 'https://cdn.jsdelivr.net/gh/schooltools123/html@main');
                const win = window.open('about:blank', '_blank');
                if (!win) return alert("Allow popups to launch modules.");

                const doc = win.document;
                
                // Inject Loading Icon
                doc.write(`
                    <style>
                        body { background: #000; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
                        .loader { border: 3px solid #111; border-top: 3px solid #4887ef; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
                        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
                    </style>
                    <div class="loader"></div>
                `);

                try {
                    const response = await fetch(finalUrl);
                    const html = await response.text();
                    doc.open();
                    doc.write(html);
                    doc.close();
                } catch (e) {
                    doc.body.innerHTML = "";
                    const iframe = doc.createElement('iframe');
                    iframe.src = finalUrl;
                    iframe.style = "position:fixed; top:0; left:0; width:100%; height:100%; border:none; background:#000;";
                    doc.body.appendChild(iframe);
                }
                setTimeout(() => { doc.title = "Google Search"; }, 500);
            }

            loadDirectory();
        </script>
    </body>
</html>
